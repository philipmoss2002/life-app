# Amplify Setup Fix - Missing amplify-meta.json

## Issue
`amplify-meta.json` is missing because the Amplify backend hasn't been pushed to AWS yet.

## Current Status

From `amplify status`:
```
┌──────────┬──────────────────────────┬───────────┬───────────────────┐
│ Category │ Resource name            │ Operation │ Provider plugin   │
├──────────┼──────────────────────────┼───────────┼───────────────────┤
│ Api      │ householddocsapp         │ Create    │ awscloudformation │
│ Auth     │ householddocsappac35c99f │ Create    │ awscloudformation │
│ Storage  │ s347b21250               │ Create    │ awscloudformation │
└──────────┴──────────────────────────┴───────────┴───────────────────┘
```

**"Create" operation means:** Resources are configured locally but not deployed to AWS.

---

## Good News! ✅

**The new solution works WITHOUT needing to push to AWS first!**

The app has a fallback configuration system:
1. Tries to use `amplifyconfiguration.dart` (generated by `amplify push`)
2. Falls back to `lib/config/amplify_config.dart` (manual config)
3. App runs in "local-only mode" if Amplify fails to initialize

---

## Solution Options

### Option 1: Deploy to AWS (Recommended for Production)

This will create the AWS resources and generate the configuration files.

#### Step 1: Initialize Amplify (if needed)

```bash
cd household_docs_app
amplify init
```

**Answer the prompts:**
- Environment name: `dev`
- Default editor: (your choice)
- App type: `flutter`
- Distribution directory: (press Enter for default)
- Build command: (press Enter for default)
- Start command: (press Enter for default)
- AWS Profile: (select your profile or create one)

#### Step 2: Push to AWS

```bash
amplify push
```

This will:
- ✅ Create Cognito User Pool
- ✅ Create Cognito Identity Pool
- ✅ Create S3 bucket
- ✅ Create AppSync API
- ✅ Generate `amplify-meta.json`
- ✅ Generate `lib/amplifyconfiguration.dart`
- ✅ Set up IAM policies

**Time:** 5-10 minutes

#### Step 3: Verify

```bash
amplify status
```

**Expected output:**
```
┌──────────┬──────────────────────────┬───────────┬───────────────────┐
│ Category │ Resource name            │ Operation │ Provider plugin   │
├──────────┼──────────────────────────┼───────────┼───────────────────┤
│ Api      │ householddocsapp         │ No Change │ awscloudformation │
│ Auth     │ householddocsappac35c99f │ No Change │ awscloudformation │
│ Storage  │ s347b21250               │ No Change │ awscloudformation │
└──────────┴──────────────────────────┴───────────┴───────────────────┘
```

---

### Option 2: Pull Existing Environment (If Already Deployed)

If the resources were already deployed to AWS but you're missing local files:

```bash
cd household_docs_app
amplify pull --appId d2x0e2spf2kss6 --envName dev
```

**App ID:** `d2x0e2spf2kss6` (from your `team-provider-info.json`)

This will:
- ✅ Download existing AWS configuration
- ✅ Generate `amplify-meta.json`
- ✅ Generate `lib/amplifyconfiguration.dart`
- ✅ Sync local files with AWS

---

### Option 3: Continue Without AWS (Development Only)

The app can run in "local-only mode" for development:

**What works:**
- ✅ Local SQLite database
- ✅ Document creation and editing
- ✅ File attachments (stored locally)
- ✅ All UI features

**What doesn't work:**
- ❌ User authentication (sign up/sign in)
- ❌ Cloud sync
- ❌ Cross-device sync

**How to use:**
1. Skip authentication screens (add bypass for development)
2. Test all local features
3. Deploy to AWS when ready for cloud features

---

## Recommended Approach

### For Development/Testing
1. **Option 1** (Deploy to AWS) - Best for full testing
2. Create a `dev` environment
3. Test all features including authentication and sync

### For Production
1. **Option 1** (Deploy to AWS)
2. Create a `prod` environment
3. Use separate AWS resources from dev

---

## Step-by-Step: Deploy to AWS

### Prerequisites

1. **AWS Account**
   - Sign up at https://aws.amazon.com if you don't have one
   - Free tier available for testing

2. **AWS CLI Configured**
   ```bash
   aws configure
   ```
   Enter:
   - AWS Access Key ID
   - AWS Secret Access Key
   - Default region: `eu-west-2` (or your preferred region)
   - Default output format: `json`

3. **Amplify CLI Installed**
   ```bash
   npm install -g @aws-amplify/cli
   ```

### Deployment Steps

#### 1. Initialize Amplify

```bash
cd household_docs_app
amplify init
```

**Prompts and Answers:**
```
? Enter a name for the project: householddocsapp
? Initialize the project with the above configuration? Yes
? Select the authentication method you want to use: AWS profile
? Please choose the profile you want to use: default
```

#### 2. Review Configuration

```bash
amplify status
```

Should show all resources with "Create" operation.

#### 3. Push to AWS

```bash
amplify push
```

**Prompts:**
```
? Are you sure you want to continue? Yes
? Do you want to generate code for your newly created GraphQL API? No
```

**Wait for deployment** (5-10 minutes)

#### 4. Verify Deployment

```bash
amplify status
```

Should show all resources with "No Change" operation.

#### 5. Check Generated Files

```bash
ls -la amplify/backend/amplify-meta.json
ls -la lib/amplifyconfiguration.dart
```

Both files should now exist.

---

## After Deployment

### 1. Update App Configuration

The app will automatically use the generated `amplifyconfiguration.dart`:

```dart
// In lib/services/amplify_service.dart
if (amplifyconfig.isNotEmpty && amplifyconfig != '{}') {
  // Uses generated configuration ✅
  await Amplify.configure(amplifyconfig);
}
```

### 2. Test Authentication

```bash
flutter run
```

Try:
1. Sign up with a new email
2. Check email for verification code
3. Sign in with credentials
4. Create a document
5. Add a file attachment
6. Verify file uploads to S3

### 3. Verify in AWS Console

**Cognito:**
- Go to AWS Console → Cognito
- Check User Pool: `householddocsappac35c99f_userpool_ac35c99f`
- Verify users are created

**S3:**
- Go to AWS Console → S3
- Check bucket: `householddocsapp9f4f55b3c6c94dc9a01229ca901e486`
- Verify files are uploaded under `private/{identityPoolId}/documents/`

---

## Troubleshooting

### Issue: "amplify init" fails

**Solution:**
```bash
# Remove existing amplify folder
rm -rf amplify

# Re-add Amplify
amplify init
```

### Issue: "amplify push" fails with permissions error

**Solution:**
```bash
# Check AWS credentials
aws sts get-caller-identity

# Reconfigure if needed
aws configure
```

### Issue: Resources already exist in AWS

**Solution:**
```bash
# Pull existing environment
amplify pull --appId d2x0e2spf2kss6 --envName dev
```

### Issue: App can't connect to AWS

**Solution:**
1. Check `lib/amplifyconfiguration.dart` exists and has content
2. Verify AWS resources are deployed: `amplify status`
3. Check app logs for Amplify initialization errors
4. Verify network connectivity

---

## Cost Considerations

### AWS Free Tier (First 12 Months)

**Cognito:**
- 50,000 MAUs (Monthly Active Users) free
- After: $0.0055 per MAU

**S3:**
- 5 GB storage free
- 20,000 GET requests free
- 2,000 PUT requests free
- After: ~$0.023 per GB/month

**AppSync:**
- 250,000 query/mutation operations free
- After: $4.00 per million operations

**Estimated Cost for Small App:**
- 100 users: **FREE** (within free tier)
- 1,000 users: ~$5-10/month
- 10,000 users: ~$50-100/month

---

## Summary

### Current State
- ❌ `amplify-meta.json` missing
- ❌ AWS resources not deployed
- ✅ Local configuration exists
- ✅ App can run in local-only mode

### Recommended Action
1. **Run `amplify push`** to deploy to AWS
2. This will create all resources and generate missing files
3. App will then work with full cloud features

### Alternative
- Continue development in local-only mode
- Deploy to AWS when ready for cloud features

---

## Next Steps

1. **Decide:** Deploy now or continue local development?

2. **If deploying:**
   ```bash
   cd household_docs_app
   amplify push
   ```

3. **If continuing local:**
   - Add authentication bypass for development
   - Test all local features
   - Deploy when ready

4. **After deployment:**
   - Test authentication
   - Test file upload/download
   - Verify sync functionality

---

**Need Help?**
- Amplify Docs: https://docs.amplify.aws/
- AWS Console: https://console.aws.amazon.com/
- Amplify Discord: https://discord.gg/amplify

---

**Last Updated:** January 17, 2026
